<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a2a6c">
    <meta name="description" content="Sistema de Controle Financeiro com Firebase e PWA">
    <link rel="icon" type="image/x-icon" href="/2224480_card_credit card_debit card_master card_icon.png">
    <title>Controle Financeiro Online</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <link rel="manifest" href="app.webmanifest">
    <link rel="apple-touch-icon" href="icon-192x192.png">

    <style>
        
/* Estilos anteriores com melhorias para PWA */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

:root {
    --primary: #1a2a6c;
    --secondary: #b21f1f;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --dark: #343a40;
    --light: #f8f9fa;
    --pago: #d4edda;
    --pendente: #fff3cd;
    --chart-1: #4e73df;
    --chart-2: #1cc88a;
    --chart-3: #36b9cc;
    --chart-4: #f6c23e;
    --chart-5: #e74a3b;
    --chart-6: #ff0080; /* Cor ajustada para ser mais distinta */
    --chart-7: #ffb4dd; /* Cor ajustada para ser mais distinta */


body {
    background: linear-gradient(135deg, var(--primary), var(--secondary), var(--primary));
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    min-height: 100vh;
    padding: 20px; /* Ser√° ajustado pelas media queries */
    color: #333;
}

@keyframes gradientBG {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

header {
    text-align: center;
    padding: 20px 0;
    color: white;
    margin-bottom: 30px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

header h1 {
    font-size: 2.8rem;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

header h1 i {
    font-size: 3rem; /* Tamanho do √≠cone ajustado para h1 */
}

header p {
    font-size: 1.2rem;
    opacity: 0.9;
    max-width: 600px;
    margin: 0 auto;
}

.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Ajustado para min-width menor */
    gap: 20px;
    margin-bottom: 30px;
}

.card {
    background: rgba(255, 255, 255, 0.92);
    border-radius: 15px;
    padding: 25px; /* Ser√° ajustado pelas media queries */
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
}

.card:hover {
    transform: translateY(-5px);
}

.card h2 {
    font-size: 1.5rem;
    margin-bottom: 15px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 10px;
}

.card h2 i {
    font-size: 1.8rem;
}

.value {
    font-size: 2.2rem;
    font-weight: bold;
    text-align: center;
    margin-top: auto;
}

.positive {
    color: var(--success);
}

.negative {
    color: var(--danger);
}

.tabs {
    display: flex;
    background: white;
    border-radius: 12px 12px 0 0;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    flex-wrap: wrap;
}

.tab-button {
    padding: 18px 20px;
    text-align: center;
    background: #f8f9fa;
    border: none;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: 600;
    color: #495057;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
    flex: 1;
    min-width: 140px;
}

.tab-button:hover {
    background: #e9ecef;
}

.tab-button.active {
    background: white;
    color: var(--primary);
    border-bottom: 3px solid var(--primary);
}

.tab-content {
    background: white;
    border-radius: 0 0 12px 12px;
    padding: 30px; /* Ser√° ajustado pelas media queries */
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
    margin-bottom: 30px;
}

.table-container {
    overflow-x: auto;
    margin: 20px 0;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th,
td {
    padding: 15px; /* Ser√° ajustado pelas media queries */
    text-align: left;
    border-bottom: 1px solid #e0e0e0;
}

th {
    background-color: var(--primary);
    color: white;
    font-weight: 600;
    position: sticky;
    top: 0;
}

tbody tr:hover {
    background-color: #f8f9fa;
}

tfoot {
    font-weight: bold;
    background-color: #f1f3f5;
}

tfoot td {
    font-size: 1.1rem;
}

.pago {
    background-color: var(--pago);
    color: #155724;
}

.pendente {
    background-color: var(--pendente);
    color: #856404;
}

input,
select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ced4da;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

input:focus,
select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(26, 42, 108, 0.1);
}

.actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-align: center;
    white-space: nowrap;
}

.btn-sm {
    padding: 8px 12px;
    font-size: 0.9rem;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover {
    background: #15225a;
    transform: translateY(-2px);
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-success:hover {
    background: #218838;
    transform: translateY(-2px);
}

.btn-danger {
    background: var(--danger);
    color: white;
}

.btn-danger:hover {
    background: #c82333;
    transform: translateY(-2px);
}

.btn-warning {
    background: var(--warning);
    color: var(--dark);
}

.btn-warning:hover {
    background: #e0a800;
    transform: translateY(-2px);
}

.btn i {
    font-size: 1.1rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.form-row > div {
    flex: 1;
    min-width: 200px;
}

.footer-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
    flex-wrap: wrap;
}

.btn-large {
    padding: 15px 30px;
    font-size: 1.1rem;
    min-width: 250px;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-content {
    background: white;
    border-radius: 15px;
    width: 100%;
    max-width: 600px;
    padding: 30px;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
}

.close {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 1.8rem;
    cursor: pointer;
    color: #6c757d;
    background: none;
    border: none;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.close:hover {
    background: #f1f1f1;
}

.login-container {
    background: white;
    border-radius: 15px;
    max-width: 500px;
    margin: 50px auto;
    padding: 40px;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
}

.login-form .form-group {
    margin-bottom: 25px;
}

.login-form h2 {
    text-align: center;
    margin-bottom: 30px;
    color: var(--primary);
}

.logo {
    text-align: center;
    margin-bottom: 30px;
}

.logo i {
    font-size: 4rem;
    color: var(--primary);
    background: rgba(26, 42, 108, 0.1);
    padding: 20px;
    border-radius: 50%;
}

/* Status de sincroniza√ß√£o */
.sync-status {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--success);
    color: white;
    padding: 10px 20px;
    border-radius: 50px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 100;
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.hidden {
    display: none;
}

/* Gr√°ficos */
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Reduzido de 400px para 300px */
    gap: 20px;
    margin-top: 30px;
}

.chart-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.chart-card h3 {
    margin-bottom: 15px;
    color: var(--primary);
}

.chart-container {
    position: relative;
    height: 300px;
    width: 100%;
}

/* Painel Administrativo */
.admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.admin-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.admin-card h3 {
    margin-bottom: 15px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 10px;
}

.notification-list {
    max-height: 300px;
    overflow-y: auto;
}

.notification-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.notification-item:last-child {
    border-bottom: none;
}

/* Responsividade */
@media (max-width: 768px) {
    header h1 {
        font-size: 2.2rem;
    }
    header h1 i {
        font-size: 2.5rem; /* Ajuste para √≠cone em telas menores */
    }
    body {
        padding: 10px; /* Reduz o padding geral da p√°gina */
    }
    .card {
        padding: 15px; /* Reduz o padding interno dos cards */
    }
    .tab-button {
        min-width: 100px;
        padding: 15px 10px;
        font-size: 1rem;
    }
    .tab-content {
        padding: 20px 15px;
    }
    th,
    td {
        padding: 12px 10px;
    }
    .btn-large {
        min-width: 100%;
    }
    .modal-content {
        padding: 20px;
    }
    .charts-container {
        grid-template-columns: 1fr; /* For√ßa uma coluna em telas menores */
        gap: 15px;
    }
}

@media (max-width: 480px) {
    header h1 {
        font-size: 1.8rem;
    }
    header h1 i {
        font-size: 2rem; /* Ajuste para √≠cone em telas menores */
    }
    body {
        padding: 5px; /* Para telas muito pequenas */
    }
    .card {
        padding: 10px;
    }
    .value {
        font-size: 1.8rem;
    }
    .tab-button {
        min-width: 100%;
        border-radius: 0;
    }
    .actions {
        flex-direction: column; /* Empilha os bot√µes de a√ß√£o na tabela */
        gap: 5px;
    }
    .table-container td.actions {
        min-width: 80px; /* Garante espa√ßo m√≠nimo para a coluna de a√ß√µes */
    }
    .btn-sm {
        padding: 6px 8px;
        font-size: 0.8rem;
        width: 100%; /* Faz com que os bot√µes menores preencham a largura dispon√≠vel */
    }
    th, td {
        padding: 8px; /* Para as tabelas, se for o caso */
        font-size: 0.85rem; /* Reduzir tamanho da fonte para caber mais */
    }
    .form-row {
        flex-direction: column; /* Empilha os campos do formul√°rio */
        gap: 10px;
    }
    .form-row > div {
        min-width: unset; /* Remove o min-width para que se ajuste */
    }
    .footer-buttons {
        gap: 10px;
        flex-direction: column; /* Empilha os bot√µes do footer */
    }
}

/* Ajustes para login */
#login-container {
    display: block;
}

#main-container {
    display: none;
}       
    
}   
    </style>
</head>

<body>
    <!-- Tela de Login -->
    <div id="login-container" class="login-container">
        <div class="logo">
            <i class="fas fa-wallet"></i>
        </div>
        <div class="login-form">
            <h2>Controle Financeiro</h2>
            <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label for="login-password">Senha</label>
                <input type="password" id="login-password" placeholder="******">
            </div>
            <button class="btn btn-primary" onclick="login()">Entrar</button>
            <p style="text-align: center; margin-top: 20px;">
                <a href="#" onclick="showRegister()">Criar nova conta</a>
            </p>
        </div>
    </div>

    <!-- Conte√∫do principal ap√≥s login -->
    <div id="main-container" class="container">
        <header>
            <h1><i class="fas fa-wallet"></i> Controle Financeiro Online</h1>
            <p>Gerencie suas finan√ßas de qualquer dispositivo e compartilhe com quem quiser</p>
            <button class="btn btn-danger" onclick="logout()" style="margin-top: 10px;"><i
                    class="fas fa-sign-out-alt"></i> Sair</button>
        </header>

        <div class="dashboard">
            <div class="card">
                <h2><i class="fas fa-arrow-down"></i> Total de Entradas</h2>
                <div class="value positive" id="dashboard-entradas">R$ 0,00</div>
            </div>
            <div class="card">
                <h2><i class="fas fa-arrow-up"></i> Total de Sa√≠das</h2>
                <div class="value" id="dashboard-saidas">R$ 0,00</div>
            </div>
            <div class="card">
                <h2><i class="fas fa-scale-balanced"></i> Saldo Final</h2>
                <div class="value" id="dashboard-saldo">R$ 0,00</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('entradas')">Entradas</button>
            <button class="tab-button" onclick="openTab('saidas')">Sa√≠das</button>
            <button class="tab-button" onclick="openTab('resumo')">Resumo</button>
            <button class="tab-button" onclick="openTab('graficos')"><i class="fas fa-chart-bar"></i> Gr√°ficos</button>
            <button class="tab-button" onclick="openTab('admin')" id="admin-tab"><i class="fas fa-user-shield"></i>
                Admin</button>
            <button class="tab-button" onclick="openTab('config')"><i class="fas fa-cog"></i> Configura√ß√µes</button>
        </div>

        <div id="entradas" class="tab-content">
            <h2><i class="fas fa-arrow-down"></i> Entradas</h2>
            <div class="table-container">
                <table id="tblEntradas">
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>Valor (R$)</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados ser√£o inseridos via JS -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>Total de Entradas</td>
                            <td id="totalEntradas">R$ 0,00</td>
                            <td><button class="btn btn-success" onclick="addEntrada()"><i class="fas fa-plus"></i>
                                    Adicionar</button></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div id="saidas" class="tab-content" style="display:none">
            <h2><i class="fas fa-arrow-up"></i> Sa√≠das</h2>
            <div class="table-container">
                <table id="tblSaidas">
                    <thead>
                        <tr>
                            <th>Categoria</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor (R$)</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados ser√£o inseridos via JS -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2">Total de Sa√≠das</td>
                            <td id="totalSaidas">R$ 0,00</td>
                            <td colspan="2"><button class="btn btn-success" onclick="addSaida()"><i
                                        class="fas fa-plus"></i> Adicionar</button></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div id="resumo" class="tab-content" style="display:none">
            <h2><i class="fas fa-file-invoice-dollar"></i> Resumo Financeiro</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Valor (R$)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Total de Entradas</td>
                            <td id="resumoEntradas">R$ 0,00</td>
                        </tr>
                        <tr>
                            <td>Total de Sa√≠das</td>
                            <td id="resumoSaidas">R$ 0,00</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><strong>Saldo Final</strong></td>
                            <td id="saldoFinal">R$ 0,00</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div id="graficos" class="tab-content" style="display:none">
            <h2><i class="fas fa-chart-bar"></i> Gr√°ficos e Relat√≥rios</h2>
            <div class="charts-container">
                <div class="chart-card">
                    <h3>Distribui√ß√£o de Sa√≠das por Categoria</h3>
                    <div class="chart-container">
                        <canvas id="categoriaChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Evolu√ß√£o Mensal</h3>
                    <div class="chart-container">
                        <canvas id="evolucaoChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Status de Pagamentos</h3>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Comparativo Entradas x Sa√≠das</h3>
                    <div class="chart-container">
                        <canvas id="comparativoChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin" class="tab-content" style="display:none">
            <h2><i class="fas fa-user-shield"></i> Painel Administrativo</h2>

            <div class="admin-grid">
                <div class="admin-card">
                    <h3><i class="fas fa-users"></i> Usu√°rios</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>√öltimo Login</th>
                                </tr>
                            </thead>
                            <tbody id="admin-users">
                                <!-- Dados de usu√°rios -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-bell"></i> Notifica√ß√µes</h3>
                    <div class="notification-list" id="notification-list">
                        <!-- Notifica√ß√µes -->
                    </div>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-envelope"></i> Enviar Notifica√ß√£o</h3>
                    <div class="form-group">
                        <label for="notification-email">Email do Destinat√°rio</label>
                        <input type="email" id="notification-email" placeholder="destinatario@email.com">
                    </div>
                    <div class="form-group">
                        <label for="notification-subject">Assunto</label>
                        <input type="text" id="notification-subject" placeholder="Assunto da mensagem">
                    </div>
                    <div class="form-group">
                        <label for="notification-message">Mensagem</label>
                        <textarea id="notification-message" rows="3" placeholder="Digite sua mensagem..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="sendNotification()"><i class="fas fa-paper-plane"></i>
                        Enviar</button>
                </div>
            </div>
        </div>

        <div id="config" class="tab-content" style="display:none">
            <h2><i class="fas fa-cog"></i> Configura√ß√µes</h2>

            <div class="card">
                <h3><i class="fas fa-globe"></i> Publicar Online</h3>
                <p>Compartilhe seu controle financeiro com outros usu√°rios:</p>
                <div class="form-group">
                    <label for="shareLink">Link de Compartilhamento</label>
                    <div class="form-row">
                        <input type="text" id="shareLink" readonly>
                        <button class="btn btn-primary" onclick="copyShareLink()"><i class="fas fa-copy"></i> Copiar
                            Link</button>
                    </div>
                </div>
                <button class="btn btn-success" onclick="generateShareLink()"><i class="fas fa-share-alt"></i> Gerar
                    Link P√∫blico</button>
            </div>

            <div class="card">
                <h3><i class="fas fa-download"></i> Backup de Dados</h3>
                <p>Fa√ßa backup dos seus dados financeiros:</p>
                <div class="footer-buttons">
                    <button class="btn btn-primary" onclick="exportData()"><i class="fas fa-file-export"></i> Exportar
                        Dados</button>
                    <button class="btn btn-warning" onclick="document.getElementById('importFile').click()"><i
                            class="fas fa-file-import"></i> Importar Dados</button>
                    <input type="file" id="importFile" accept=".json" style="display: none"
                        onchange="importData(event)">
                </div>
            </div>

            <div class="card">
                <h3><i class="fas fa-sync-alt"></i> Sincroniza√ß√£o</h3>
                <p>Mantenha seus dados atualizados em todos os dispositivos:</p>
                <div class="footer-buttons">
                    <button class="btn btn-primary" onclick="saveToCloud()"><i class="fas fa-cloud-upload-alt"></i>
                        Salvar na Nuvem</button>
                    <button class="btn btn-success" onclick="loadFromCloud()"><i class="fas fa-cloud-download-alt"></i>
                        Carregar da Nuvem</button>
                </div>
            </div>
        </div>

        <div class="footer-buttons">
            <button class="btn btn-primary btn-large" onclick="gerarPDF()"><i class="fas fa-file-pdf"></i> Exportar para
                PDF</button>
            <button class="btn btn-warning btn-large" onclick="resetData()"><i class="fas fa-sync-alt"></i> Reiniciar
                Dados</button>
        </div>
    </div>

    <!-- Modais -->
    <div id="entradaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('entradaModal')">&times;</span>
            <h2><i class="fas fa-plus-circle"></i> Adicionar Nova Entrada</h2>
            <div class="form-group">
                <label for="entradaDescricao">Descri√ß√£o</label>
                <input type="text" id="entradaDescricao" placeholder="Ex: Sal√°rio">
            </div>
            <div class="form-group">
                <label for="entradaValor">Valor (R$)</label>
                <input type="text" id="entradaValor" placeholder="Ex: 1500,00">
            </div>
            <button class="btn btn-primary" onclick="saveEntrada()"><i class="fas fa-save"></i> Salvar Entrada</button>
        </div>
    </div>

    <div id="saidaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('saidaModal')">&times;</span>
            <h2><i class="fas fa-plus-circle"></i> Adicionar Nova Sa√≠da</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="saidaCategoria">Categoria</label>
                    <select id="saidaCategoria">
                        <option value="üí≥ Cart√£o de Cr√©dito">üí≥ Cart√£o de Cr√©dito</option>
                        <option value="üåê Internet & Celular">üåê Internet & Celular</option>
                        <option value="üßæ Contas Fixas">üßæ Contas Fixas</option>
                        <option value="üíá Cuidado Pessoal">üíá Cuidado Pessoal</option>
                        <option value="üîß Manuten√ß√£o">üîß Manuten√ß√£o</option>
                        <option value="üçî Alimenta√ß√£o">üçî Alimenta√ß√£o</option>
                        <option value="‚ö∞Ô∏è Outros Gastos">‚ö∞Ô∏è Outros Gastos</option>
                        <option value="üí∏ Outros Gastos">üí∏ Outros Gastos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="saidaStatus">Status</label>
                    <select id="saidaStatus">
                        <option value="Pago">Pago</option>
                        <option value="Pendente">Pendente</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="saidaDescricao">Descri√ß√£o</label>
                <input type="text" id="saidaDescricao" placeholder="Ex: Pagamento de conta">
            </div>
            <div class="form-group">
                <label for="saidaValor">Valor (R$)</label>
                <input type="text" id="saidaValor" placeholder="Ex: 250,00">
            </div>
            <div class="form-group">
                <label for="saidaVencimento">Data de Vencimento</label>
                <input type="date" id="saidaVencimento">
            </div>
            <button class="btn btn-primary" onclick="saveSaida()"><i class="fas fa-save"></i> Salvar Sa√≠da</button>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Criar Nova Conta</h2>
            <div class="form-group">
                <label for="register-email">Email</label>
                <input type="email" id="register-email" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label for="register-password">Senha</label>
                <input type="password" id="register-password" placeholder="******">
            </div>
            <div class="form-group">
                <label for="register-password-confirm">Confirmar Senha</label>
                <input type="password" id="register-password-confirm" placeholder="******">
            </div>
            <button class="btn btn-primary" onclick="register()">Registrar</button>\<p
                style="text-align: center; margin-top: 20px;">
                <a href="#" onclick="backToLogin()">Voltar para o login</a>
            </p>
        </div>
    </div>

    <!-- Status de sincroniza√ß√£o -->
    <div id="syncStatus" class="sync-status hidden">
        <i class="fas fa-sync-alt fa-spin"></i>
        <span id="syncMessage">Sincronizando dados...</span>
    </div>

    <script>

        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCLS-1GwCoyQVRCAHG_b2fwVOcIRjAEu-0",
            authDomain: "controle-financeiro-onli-a2584.firebaseapp.com",
            projectId: "controle-financeiro-onli-a2584",
            storageBucket: "controle-financeiro-onli-a2584.firebasestorage.app",
            messagingSenderId: "929745653564",
            appId: "1:929745653564:web:7e25c5e6d071055ab15839",
            measurementId: "G-PK9Z9K4MZT"
        };

        // Inicializar Firebase

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Vari√°veis globais
        let entradas = [];
        let saidas = [];
        let currentUser = null;
        let isAdmin = false;

        // Observador de estado de autentica√ß√£o
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';

                // Carregar dados do usu√°rio
                loadUserData();

                // Atualizar √∫ltimo login
                db.collection('users').doc(user.uid).set({
                    lastLogin: new Date()
                }, { merge: true });

            } else {
                document.getElementById('login-container').style.display = 'block';
                document.getElementById('main-container').style.display = 'none';
            }
        });


        // Fun√ß√£o para salvar dados no Firebase
        function saveData() {
            if (!currentUser) return;

            const userRef = db.collection('users').doc(currentUser.uid);

            userRef.set({
                entradas: entradas,
                saidas: saidas,
                lastUpdate: new Date()
            }, { merge: true })
                .then(() => {
                    console.log('Dados salvos com sucesso!');
                    showSyncStatus('Dados salvos na nuvem!', 'success');
                })
                .catch(error => {
                    console.error('Erro ao salvar dados:', error);
                    showSyncStatus('Erro ao salvar dados!', 'error');
                });
        }

        // Fun√ß√£o para carregar dados do Firebase
        function loadUserData() {
            if (!currentUser) return;

            const userRef = db.collection('users').doc(currentUser.uid);

            userRef.get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    entradas = data.entradas || [];
                    saidas = data.saidas || [];

                    // Atualizar interface
                    renderizarTabelas();
                    calcularTotais();

                    showSyncStatus('Dados carregados!', 'success');
                } else {
                    // Primeiro acesso - criar documento
                    userRef.set({
                        entradas: [],
                        saidas: [],
                        created: new Date()
                    });
                }
            }).catch(error => {
                console.error('Erro ao carregar dados:', error);
                showSyncStatus('Erro ao carregar dados!', 'error');
            });
        }

        // Fun√ß√£o de login
        function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            auth.signInWithEmailAndPassword(email, password)
                .then(() => showSyncStatus('Login realizado!', 'success'))
                .catch(error => {
                    console.error('Erro de login:', error);
                    showSyncStatus(`Erro: ${error.message}`, 'error');
                });
        }

        // Fun√ß√£o de logout

        function logout() {
            auth.signOut()
                .then(() => {
                    showSyncStatus('Logout realizado com sucesso!', 'success');
                })
                .catch((error) => {
                    showSyncStatus(`Erro: ${error.message}`, 'error');
                });
        }



            function showRegister() {
                openModal('registerModal');
            }



        function backToLogin() {
            const registerModal = document.getElementById('registerModal');
            registerModal.style.display = 'none';
            document.getElementById('login-container').style.display = 'block';
        }



        function closeModal(modalId) {
                let modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = "none"; // Esconde o modal
                } else {
                    console.error(`Erro: O modal com ID '${modalId}' n√£o foi encontrado.`);
                }
            }



        function register() {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-password-confirm').value;

            if (password !== confirmPassword) {
                showSyncStatus('As senhas n√£o coincidem!', 'error');
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(() => {
                    closeModal('registerModal');
                    showSyncStatus('Conta criada com sucesso!', 'success');
                })
                .catch(error => showSyncStatus(`Erro: ${error.message}`, 'error'));
        }

        function showSyncStatus(message, type) {
            alert(message); // Simples para testes; pode customizar depois
        }

        // Registrar o Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then(() => console.log('Service Worker registrado!'))
                .catch(error => console.error('Erro ao registrar Service Worker:', error));
        }


        function adicionarEntrada() {
            const descricao = document.getElementById('descricaoEntrada').value;
            const valor = parseFloat(document.getElementById('valorEntrada').value);

            if (descricao && !isNaN(valor)) {
                entradas.push({ descricao, valor });
                renderizarTabelas();
                calcularTotais();
                saveData();
            }
        }

        function adicionarSaida() {
            const descricao = document.getElementById('descricaoSaida').value;
            const valor = parseFloat(document.getElementById('valorSaida').value);

            if (descricao && !isNaN(valor)) {
                saidas.push({ descricao, valor });
                renderizarTabelas();
                calcularTotais();
                saveData();
            }
        }

        function removerEntrada(index) {
            entradas.splice(index, 1);
            renderizarTabelas();
            calcularTotais();
            saveData();
        }

        function removerSaida(index) {
            saidas.splice(index, 1);
            renderizarTabelas();
            calcularTotais();
            saveData();
        }



        // Fun√ß√£o de salvamento √öNICA
        function saveData() {
            if (!currentUser) return;

            db.collection('users').doc(currentUser.uid).set({
                entradas: entradas,
                saidas: saidas,
                lastUpdate: new Date()
            }, { merge: true }) // IMPORTANTE: merge mant√©m outros campos
                .then(() => console.log("Dados salvos!"))
                .catch(error => console.error("Erro ao salvar:", error));
        }

        // Fun√ß√£o de carregamento √öNICA
        function loadUserData() {
            if (!currentUser) return;

            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        entradas = data.entradas || [];
                        saidas = data.saidas || [];
                        renderizarTabelas();
                        calcularTotais();
                    }
                })
                .catch(error => console.error("Erro ao carregar:", error));
        }

        function checkAdminStatus() {
            if (!currentUser) return;

            db.collection('admins').doc(currentUser.uid).get()
                .then(doc => {
                    isAdmin = doc.exists;
                });
        }


        // Fun√ß√µes principais
        function renderizarTabelas() {
            renderEntradas();
            renderSaidas();
        }

        function renderEntradas() {
            const tbody = document.querySelector('#tblEntradas tbody');
            tbody.innerHTML = '';

            entradas.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.descricao}</td>
                    <td>${formatarMoeda(item.valor)}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editarEntrada(${index})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm" onclick="removerEntrada(${index})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }


        function renderSaidas() {
            const tbody = document.querySelector('#tblSaidas tbody');
            tbody.innerHTML = '';

            saidas.forEach((item, index) => {
                const tr = document.createElement('tr');

                // Obter cor da categoria
                const bgColor = getCategoriaColor(item.categoria);

                // Aplicar estilo de cor
                tr.style.backgroundColor = bgColor + '22';  // Adiciona transpar√™ncia
                tr.style.borderLeft = `4px solid ${bgColor}`;

                tr.innerHTML = `
                <td>${item.categoria}</td>
                <td>${item.descricao}</td>
                <td>${formatarMoeda(item.valor)}</td>
                <td class="${item.status === 'Pago' ? 'pago' : 'pendente'}">${item.status}</td>
                <td class="actions">
                    <button class="btn btn-primary btn-sm" onclick="editarSaida(${index})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="removerSaida(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
                tbody.appendChild(tr);
            });
        }

        // Fun√ß√£o para obter cores em hexadecimal
        function getCategoriaColor(categoria) {
            const colorMap = {
                "üí≥ Cart√£o de Cr√©dito": "#4e73df",
                "üåê Internet & Celular": "#1cc88a",
                "üßæ Contas Fixas": "#36b9cc",
                "üíá Cuidado Pessoal": "#f6c23e",
                "üîß Manuten√ß√£o": "#e74a3b",
                "üçî Alimenta√ß√£o": "#858796",
                "‚ö∞Ô∏è Outros Gastos": "#ff0080",
                "üí∏ Outros Gastos": "#ffb4dd"
            };
            return colorMap[categoria] || "#e5ff00";
        }


        function calcularTotais() {
            // Entradas
            const totalEntradas = entradas.reduce((sum, item) => sum + item.valor, 0);
            document.getElementById('totalEntradas').textContent = formatarMoeda(totalEntradas);
            document.getElementById('resumoEntradas').textContent = formatarMoeda(totalEntradas);
            document.getElementById('dashboard-entradas').textContent = formatarMoeda(totalEntradas);

            // Sa√≠das
            const totalSaidas = saidas.reduce((sum, item) => sum + item.valor, 0);
            document.getElementById('totalSaidas').textContent = formatarMoeda(totalSaidas);
            document.getElementById('resumoSaidas').textContent = formatarMoeda(totalSaidas);
            document.getElementById('dashboard-saidas').textContent = formatarMoeda(totalSaidas);

            // Saldo
            const saldo = totalEntradas - totalSaidas;
            document.getElementById('saldoFinal').textContent = formatarMoeda(saldo);
            document.getElementById('dashboard-saldo').textContent = formatarMoeda(saldo);

            // Estiliza√ß√£o do saldo
            const saldoElem = document.getElementById('dashboard-saldo');
            saldoElem.className = 'value ' + (saldo < 0 ? 'negative' : 'positive');

            // Salvar dados no Firebase
            saveData();

            // Atualizar gr√°ficos
            if (document.getElementById('graficos').style.display !== 'none') {
                renderizarGraficos();
            }
        }

        // Fun√ß√µes para adicionar/editar entradas
        function addEntrada() {
            document.getElementById('entradaDescricao').value = '';
            document.getElementById('entradaValor').value = '';
            openModal('entradaModal');
        }

        function saveEntrada() {
            const descricao = document.getElementById('entradaDescricao').value;
            const valor = parseFloat(document.getElementById('entradaValor').value.replace(',', '.'));

            if (!descricao || isNaN(valor)) {
                alert('Por favor, preencha todos os campos corretamente!');
                return;
            }

            entradas.push({ descricao, valor });
            closeModal('entradaModal');
            renderizarTabelas();
            calcularTotais();
        }

        function editarEntrada(index) {
            document.getElementById('entradaDescricao').value = entradas[index].descricao;
            document.getElementById('entradaValor').value = entradas[index].valor;
            openModal('entradaModal');

            // Substitui a entrada ao salvar
            const saveBtn = document.querySelector('#entradaModal .btn');
            saveBtn.onclick = function () {
                const descricao = document.getElementById('entradaDescricao').value;
                const valor = parseFloat(document.getElementById('entradaValor').value.replace(',', '.'));

                if (!descricao || isNaN(valor)) {
                    alert('Por favor, preencha todos os campos corretamente!');
                    return;
                }

                entradas[index] = { descricao, valor };
                closeModal('entradaModal');
                renderizarTabelas();
                calcularTotais();
            };
        }

        function removerEntrada(index) {
            if (confirm('Tem certeza que deseja remover esta entrada?')) {
                entradas.splice(index, 1);
                renderEntradas();
                calcularTotais();
            }
        }

        // Fun√ß√µes para adicionar/editar sa√≠das
        function addSaida() {
            document.getElementById('saidaCategoria').value = 'üí≥ Cart√£o de Cr√©dito';
            document.getElementById('saidaDescricao').value = '';
            document.getElementById('saidaValor').value = '';
            document.getElementById('saidaStatus').value = 'Pendente';
            document.getElementById('saidaVencimento').value = '';
            openModal('saidaModal');
        }

        function saveSaida() {
            const categoria = document.getElementById('saidaCategoria').value;
            const descricao = document.getElementById('saidaDescricao').value;
            const valor = parseFloat(document.getElementById('saidaValor').value.replace(',', '.'));
            const status = document.getElementById('saidaStatus').value;
            const vencimento = document.getElementById('saidaVencimento').value;

            if (!descricao || isNaN(valor)) {
                alert('Por favor, preencha todos os campos corretamente!');
                return;
            }

            saidas.push({ categoria, descricao, valor, status, vencimento });
            closeModal('saidaModal');
            renderizarTabelas();
            calcularTotais();

            // Verificar se √© necess√°rio enviar notifica√ß√£o
            if (vencimento) {
                const hoje = new Date();
                const dataVencimento = new Date(vencimento);
                const diffDias = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));

                if (diffDias <= 3 && diffDias >= 0) {
                    const notification = {
                        title: 'Conta pr√≥xima do vencimento',
                        message: `A conta "${descricao}" vence em ${diffDias} dias`,
                        timestamp: new Date().getTime()
                    };
                    saveNotification(notification);
                }
            }
        }

        function editarSaida(index) {
            document.getElementById('saidaCategoria').value = saidas[index].categoria;
            document.getElementById('saidaDescricao').value = saidas[index].descricao;
            document.getElementById('saidaValor').value = saidas[index].valor;
            document.getElementById('saidaStatus').value = saidas[index].status;
            document.getElementById('saidaVencimento').value = saidas[index].vencimento || '';
            openModal('saidaModal');

            // Substitui a sa√≠da ao salvar
            const saveBtn = document.querySelector('#saidaModal .btn');
            saveBtn.onclick = function () {
                const categoria = document.getElementById('saidaCategoria').value;
                const descricao = document.getElementById('saidaDescricao').value;
                const valor = parseFloat(document.getElementById('saidaValor').value.replace(',', '.'));
                const status = document.getElementById('saidaStatus').value;
                const vencimento = document.getElementById('saidaVencimento').value;

                if (!descricao || isNaN(valor)) {
                    alert('Por favor, preencha todos os campos corretamente!');
                    return;
                }

                saidas[index] = { categoria, descricao, valor, status, vencimento };
                closeModal('saidaModal');
                renderizarTabelas();
                calcularTotais();
            };
        }

        function removerSaida(index) {
            if (confirm('Tem certeza que deseja remover esta sa√≠da?')) {
                saidas.splice(index, 1);
                renderSaidas();
                calcularTotais();
            }
        }

    // Fun√ß√µes de gr√°ficos
    function renderizarGraficos() {
        // Gr√°fico de categorias
        const categorias = {};
        saidas.forEach(saida => {
            if (categorias[saida.categoria]) {
                categorias[saida.categoria] += saida.valor;
            } else {
                categorias[saida.categoria] = saida.valor;
            }
        });

        // Crie um array de cores dinamicamente usando getCategoriaColor
        const categoryColors = Object.keys(categorias).map(categoria => getCategoriaColor(categoria));

        const categoriaCtx = document.getElementById('categoriaChart').getContext('2d');

        // Destrua o gr√°fico existente antes de criar um novo, se houver
        if (window.categoriaChartInstance) {
            window.categoriaChartInstance.destroy();
        }

        window.categoriaChartInstance = new Chart(categoriaCtx, { // Armazene a inst√¢ncia globalmente
            type: 'doughnut',
            data: {
                labels: Object.keys(categorias),
                datasets: [{
                    data: Object.values(categorias),
                    backgroundColor: categoryColors // Use as cores geradas aqui
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                }
            }
        });

        // Gr√°fico de status
        const statusCount = {
            'Pago': saidas.filter(s => s.status === 'Pago').length,
            'Pendente': saidas.filter(s => s.status === 'Pendente').length
        };

        const statusCtx = document.getElementById('statusChart').getContext('2d');
        // Destrua o gr√°fico existente antes de criar um novo, se houver
        if (window.statusChartInstance) {
            window.statusChartInstance.destroy();
        }
        window.statusChartInstance = new Chart(statusCtx, {
            type: 'pie',
            data: {
                labels: ['Pago', 'Pendente'],
                datasets: [{
                    data: [statusCount.Pago, statusCount.Pendente],
                    backgroundColor: ['var(--success)', 'var(--warning)'] // Mant√©m as vari√°veis CSS
                }]
            },
            options: {
                responsive: true
            }
        });

        // Gr√°fico comparativo
        const totalEntradas = entradas.reduce((sum, item) => sum + item.valor, 0);
        const totalSaidas = saidas.reduce((sum, item) => sum + item.valor, 0);

        const comparativoCtx = document.getElementById('comparativoChart').getContext('2d');
        // Destrua o gr√°fico existente antes de criar um novo, se houver
        if (window.comparativoChartInstance) {
            window.comparativoChartInstance.destroy();
        }
        window.comparativoChartInstance = new Chart(comparativoCtx, {
            type: 'bar',
            data: {
                labels: ['Entradas', 'Sa√≠das'],
                datasets: [{
                    label: 'Valores',
                    data: [totalEntradas, totalSaidas],
                    backgroundColor: ['var(--success)', 'var(--danger)'] // Mant√©m as vari√°veis CSS
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Gr√°fico de evolu√ß√£o mensal
        const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
        // **Importante:** Os dados de entradasMensais e saidasMensais est√£o simulados com Math.random().
        // Para um gr√°fico real, voc√™ precisaria calcular esses valores a partir dos seus dados de 'entradas' e 'saidas' por m√™s.
        const entradasMensais = meses.map(() => Math.floor(Math.random() * 5000) + 2000);
        const saidasMensais = meses.map(() => Math.floor(Math.random() * 4500) + 1500);

        const evolucaoCtx = document.getElementById('evolucaoChart').getContext('2d');
        // Destrua o gr√°fico existente antes de criar um novo, se houver
        if (window.evolucaoChartInstance) {
            window.evolucaoChartInstance.destroy();
        }
        window.evolucaoChartInstance = new Chart(evolucaoCtx, {
            type: 'line',
            data: {
                labels: meses,
                datasets: [
                    {
                        label: 'Entradas',
                        data: entradasMensais,
                        borderColor: 'var(--success)', // Mant√©m as vari√°veis CSS
                        backgroundColor: 'rgba(40, 167, 69, 0.1)', // Cor de fundo da √°rea abaixo da linha
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Sa√≠das',
                        data: saidasMensais,
                        borderColor: 'var(--danger)', // Mant√©m as vari√°veis CSS
                        backgroundColor: 'rgba(220, 53, 69, 0.1)', // Cor de fundo da √°rea abaixo da linha
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

        // Fun√ß√µes de notifica√ß√£o
        function saveNotification(notification) {
            if (!currentUser) return;

            db.collection('notifications').add({
                userId: currentUser.uid,
                title: notification.title,
                message: notification.message,
                timestamp: notification.timestamp,
                read: false
            });
        }

        function loadNotifications() {
            if (!currentUser) return;

            db.collection('notifications')
                .where('userId', '==', currentUser.uid)
                .orderBy('timestamp', 'desc')
                .limit(10)
                .get()
                .then(snapshot => {
                    const notificationList = document.getElementById('notification-list');
                    notificationList.innerHTML = '';

                    snapshot.forEach(doc => {
                        const notification = doc.data();
                        const item = document.createElement('div');
                        item.className = 'notification-item';
                        item.innerHTML = `
                            <strong>${notification.title}</strong>
                            <p>${notification.message}</p>
                            <small>${new Date(notification.timestamp).toLocaleString()}</small>
                        `;
                        notificationList.appendChild(item);
                    });
                });
        }

        function sendNotification() {
            const email = document.getElementById('notification-email').value;
            const subject = document.getElementById('notification-subject').value;
            const message = document.getElementById('notification-message').value;

            if (!email || !subject || !message) {
                showSyncStatus('Por favor, preencha todos os campos!', 'error');
                return;
            }

            // Simula√ß√£o de envio de email
            showSyncStatus(`Notifica√ß√£o enviada para ${email}`, 'success');

            // Limpar campos
            document.getElementById('notification-email').value = '';
            document.getElementById('notification-subject').value = '';
            document.getElementById('notification-message').value = '';
        }

        // Fun√ß√µes administrativas
        function checkAdminStatus() {
            if (!currentUser) return;

            // Verificar se o usu√°rio √© admin (neste exemplo, qualquer usu√°rio √© admin)
            isAdmin = true;
            document.getElementById('admin-tab').style.display = isAdmin ? 'block' : 'none';

            if (isAdmin) {
                loadAdminUsers();
                loadNotifications();
            }
        }

        function loadAdminUsers() {
            db.collection('users').get().then(snapshot => {
                const usersTable = document.getElementById('admin-users');
                usersTable.innerHTML = '';

                snapshot.forEach(doc => {
                    const user = doc.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${user.email}</td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'N/A'}</td>
                    `;
                    usersTable.appendChild(tr);
                });
            });
        }

        // Fun√ß√µes de persist√™ncia

        function saveData() {
            if (!currentUser) return;

            const data = {
                entradas: entradas,
                saidas: saidas,
                timestamp: new Date().getTime()
            };

            db.collection('users').doc(currentUser.uid).set(data, { merge: true })
                .then(() => {
                    console.log('Dados salvos no Firebase');
                })
                .catch(error => {
                    console.error('Erro ao salvar dados:', error);
                });
        }

        function loadUserData() {
            if (!currentUser) return;

            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        entradas = data.entradas || [];
                        saidas = data.saidas || [];
                        renderizarTabelas();
                        calcularTotais();

                        // Atualizar √∫ltimo login
                        db.collection('users').doc(currentUser.uid).set({
                            email: currentUser.email,
                            lastLogin: new Date().getTime()
                        }, { merge: true });
                    }
                });
        }

        // Fun√ß√µes auxiliares
        function formatarMoeda(valor) {
            return 'R$ ' + parseFloat(valor).toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).style.display = 'block';
            event.currentTarget.classList.add('active');

            if (tabName === 'graficos') {
                renderizarGraficos();
            } else if (tabName === 'admin' && isAdmin) {
                loadAdminUsers();
                loadNotifications();
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function resetData() {
            if (confirm('Tem certeza que deseja reiniciar todos os dados? Isso apagar√° todas as informa√ß√µes atuais.')) {
                entradas = [];
                saidas = [];
                renderizarTabelas();
                calcularTotais();
            }
        }

        function showSyncStatus(message, type = 'info') {
            const syncStatus = document.getElementById('syncStatus');
            const syncMessage = document.getElementById('syncMessage');

            syncMessage.textContent = message;
            syncStatus.className = 'sync-status';

            // Define a cor baseada no tipo
            if (type === 'success') {
                syncStatus.style.backgroundColor = 'var(--success)';
            } else if (type === 'error') {
                syncStatus.style.backgroundColor = 'var(--danger)';
            } else if (type === 'warning') {
                syncStatus.style.backgroundColor = 'var(--warning)';
                syncMessage.style.color = '#000';
            } else {
                syncStatus.style.backgroundColor = 'var(--primary)';
            }

            // Esconde ap√≥s 3 segundos
            setTimeout(() => {
                syncStatus.className = 'sync-status hidden';
            }, 3000);
        }

        // Gera√ß√£o de PDF
        function gerarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // T√≠tulo
            doc.setFontSize(20);
            doc.text("Relat√≥rio Financeiro", 105, 20, null, null, 'center');
            doc.setFontSize(12);
            doc.text(`Gerado em: ${new Date().toLocaleDateString()}`, 105, 28, null, null, 'center');

            // Tabela de Entradas
            doc.autoTable({
                startY: 35,
                head: [['Descri√ß√£o', 'Valor (R$)']],
                body: entradas.map(item => [item.descricao, formatarMoeda(item.valor)]),
                theme: 'grid',
                headStyles: { fillColor: [26, 42, 108] },
                margin: { top: 10 }
            });

            // Tabela de Sa√≠das
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 10,
                head: [['Categoria', 'Descri√ß√£o', 'Valor (R$)', 'Status']],
                body: saidas.map(item => [item.categoria, item.descricao, formatarMoeda(item.valor), item.status]),
                theme: 'grid',
                headStyles: { fillColor: [26, 42, 108] },
                didDrawCell: function (data) {
                    if (data.section === 'body' && data.column.index === 3) {
                        if (data.cell.raw === 'Pago') {
                            doc.setTextColor(21, 87, 36);
                            doc.setFillColor(212, 237, 218);
                        } else {
                            doc.setTextColor(133, 100, 4);
                            doc.setFillColor(255, 243, 205);
                        }
                        doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                        doc.text(data.cell.raw, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2 + 2, { align: 'center' });
                        return false;
                    }
                }
            });

            // Resumo
            const totalEntradas = entradas.reduce((a, b) => a + b.valor, 0);
            const totalSaidas = saidas.reduce((a, b) => a + b.valor, 0);
            const saldo = totalEntradas - totalSaidas;

            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 10,
                body: [
                    ['Total de Entradas', formatarMoeda(totalEntradas)],
                    ['Total de Sa√≠das', formatarMoeda(totalSaidas)],
                    ['Saldo Final', formatarMoeda(saldo)]
                ],
                theme: 'grid',
                headStyles: { fillColor: [26, 42, 108] },
                bodyStyles: { fontSize: 14 },
                styles: { fontStyle: 'bold' },
                didDrawCell: function (data) {
                    if (data.section === 'body' && data.row.index === 2) {
                        doc.setTextColor(saldo < 0 ? 231 : 46, saldo < 0 ? 76 : 204, saldo < 0 ? 60 : 113);
                    }
                }
            });

            doc.save(`relatorio-financeiro-${new Date().toISOString().slice(0, 10)}.pdf`);
        }

        // Fun√ß√µes de backup
        function exportData() {
            const data = {
                entradas: entradas,
                saidas: saidas
            };

            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "backup-financeiro.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();

            showSyncStatus('Backup exportado com sucesso!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    entradas = data.entradas || [];
                    saidas = data.saidas || [];
                    renderizarTabelas();
                    calcularTotais();
                    showSyncStatus('Dados importados com sucesso!', 'success');
                } catch (error) {
                    showSyncStatus('Erro ao importar dados. Arquivo inv√°lido!', 'error');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        }

        // Fun√ß√µes de compartilhamento
        function generateShareLink() {
            const shareLink = `${window.location.origin}${window.location.pathname}?share=true`;
            document.getElementById('shareLink').value = shareLink;
            showSyncStatus('Link gerado com sucesso!', 'success');
        }

        function copyShareLink() {
            const linkInput = document.getElementById('shareLink');
            linkInput.select();
            document.execCommand('copy');
            showSyncStatus('Link copiado para a √°rea de transfer√™ncia!', 'success');
        }

        // Fun√ß√µes de sincroniza√ß√£o
        function saveToCloud() {
            showSyncStatus('Salvando dados na nuvem...', 'info');
            saveData();
            setTimeout(() => {
                showSyncStatus('Dados salvos na nuvem com sucesso!', 'success');
            }, 1500);
        }

        function loadFromCloud() {
            showSyncStatus('Carregando dados da nuvem...', 'info');
            loadUserData();
            setTimeout(() => {
                showSyncStatus('Dados carregados da nuvem com sucesso!', 'success');
            }, 1500);
        }

        // PWA: Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado com sucesso:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Falha ao registrar Service Worker:', error);
                    });
            });
        }

        // PWA: Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Mostrar bot√£o de instala√ß√£o
            const installBtn = document.createElement('button');
            installBtn.textContent = 'Instalar App';
            installBtn.className = 'btn btn-primary';
            installBtn.style.position = 'fixed';
            installBtn.style.bottom = '20px';
            installBtn.style.left = '20px';
            installBtn.style.zIndex = '1000';

            installBtn.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(choiceResult => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Usu√°rio aceitou a instala√ß√£o');
                    }
                    deferredPrompt = null;
                });
            });

            document.body.appendChild(installBtn);
        });
    </script>
</body>

</html>